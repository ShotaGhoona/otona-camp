# 実装タスクチェックリスト

明日のイベントに向けた実装タスク。実装順に並べています。

---

## Phase 1: セットアップ・基盤構築

### 1. Supabaseプロジェクトセットアップ
- [ ] Supabaseプロジェクト作成
- [ ] データベーステーブル作成（SQLを実行）
  - teams
  - members
  - questions
  - options
  - votes
  - game_state
- [x] 環境変数設定（.env.local）
  - NEXT_PUBLIC_SUPABASE_URL
  - NEXT_PUBLIC_SUPABASE_ANON_KEY
  - NEXTAUTH_URL
  - NEXTAUTH_SECRET

### 2. Next.jsプロジェクト設定
- [x] Supabaseクライアントライブラリインストール
- [x] NextAuth.jsインストール
- [x] shadcn/uiインストール
- [x] Supabaseクライアント初期化（lib/supabase.ts）
- [x] セッション管理ヘルパー作成（lib/session.ts）
- [x] API呼び出しヘルパー作成（lib/api.ts）
- [x] NextAuth設定（/api/auth/[...nextauth]）
- [x] 認証ミドルウェア設定（middleware.ts）

---

## Phase 2: API実装（バックエンド）

### 3. チーム・メンバー関連API
- [x] `POST /api/teams` - チーム作成
- [x] `GET /api/teams` - チーム一覧取得
- [x] `POST /api/members` - メンバー登録
- [x] `GET /api/members/me` - 自分の情報取得

### 4. 問題管理API
- [x] `POST /api/questions` - 問題作成
- [x] `GET /api/questions` - 問題一覧取得
- [x] `GET /api/questions/:id` - 問題詳細取得
- [x] `PATCH /api/questions/:id/status` - ステータス更新

### 5. 回答・投票API
- [x] `POST /api/questions/:id/options` - 回答作成
- [x] `GET /api/questions/:id/options` - 回答一覧取得
- [x] `POST /api/questions/:id/votes` - 投票
- [x] `GET /api/questions/:id/results` - 結果取得

### 6. スコアボードAPI
- [x] `GET /api/scoreboard` - スコアボード取得

---

## Phase 3: フロントエンド実装

### 7. 認証・セットアップページ
- [x] ログインページ（/login）
  - 名前入力フォーム
  - NextAuth認証
- [x] チーム選択ページ（/team-select）
  - チーム一覧表示
  - チーム選択機能
- [x] チーム作成ページ（/team-setup）
  - チーム名入力
  - カラー選択
  - チーム作成API呼び出し
- [x] 共通ヘッダーコンポーネント
  - ログアウトボタン

### 8. 問題一覧・スコアボード
- [x] 問題一覧ページ（/questions）
  - 問題一覧表示
  - ステータス別アイコン表示
  - 自チーム情報とスコア表示
  - Realtime購読（問題ステータス更新）
- [x] スコアボードページ（/scoreboard）
  - チーム順位表示
  - プログレスバー
  - Realtime購読（スコア更新）

### 9. 問題詳細ページ（3フェーズ）
- [x] 回答フェーズページ（/questions/:id/answer）
  - 問題文表示
  - ステップインジケーター
  - 回答入力フォーム（テキスト/画像URL）
  - タイマー表示
  - 他チーム進捗表示
  - Realtime購読（回答数更新）
- [x] 投票フェーズページ（/questions/:id/vote）
  - 全チームの回答表示
  - 投票ボタン
  - 自チーム投票不可表示
  - 投票済み状態表示
  - Realtime購読（投票数更新）
- [x] 結果フェーズページ（/questions/:id/result）
  - ランキング表示
  - 獲得ポイント表示
  - 次の問題へボタン

### 10. ゲームマスターページ
- [x] ゲームマスターダッシュボード（/gamemaster）
  - 問題一覧表示
  - ステータス管理
  - 次のフェーズへボタン
- [x] 問題作成ページ（/gamemaster/questions/new）
  - 問題文入力
  - 回答タイプ選択
  - 制限時間・配点設定
  - 問題作成API呼び出し

---

## Phase 4: リアルタイム機能実装

### 11. Supabase Realtime購読設定
- [ ] 問題一覧のリアルタイム更新
  - questionsテーブル変更を購読
  - ステータス変更時にUI更新
- [ ] 回答フェーズの進捗リアルタイム更新
  - optionsテーブル変更を購読
  - 回答数カウント更新
- [ ] 投票フェーズのリアルタイム更新
  - votesテーブル変更を購読
  - 投票数更新
- [ ] スコアボードのリアルタイム更新
  - teamsテーブル変更を購読
  - スコア更新

---

## Phase 5: UI/UX調整

### 12. スタイリング
- [ ] Tailwind CSS設定確認
- [ ] レスポンシブデザイン（モバイル最適化）
- [ ] カラーパレット設定
- [ ] ボタン・カードコンポーネント統一

### 13. UX改善
- [ ] ローディング状態表示
- [ ] エラーハンドリング
- [ ] トースト通知（投票完了など）
- [ ] 画面遷移アニメーション（オプション）

---

## Phase 6: テスト・デプロイ

### 14. 動作確認
- [ ] ローカル環境で全フロー確認
  - チーム作成 → メンバー登録
  - 問題作成 → 回答 → 投票 → 結果
  - スコア更新確認
  - リアルタイム更新確認
- [ ] 複数デバイスでテスト（スマホ2台以上）
- [ ] エッジケース確認
  - 回答なしで投票フェーズへ
  - 投票なしで結果表示
  - 同時アクセス

### 15. Vercelデプロイ
- [ ] Vercelプロジェクト作成
- [ ] 環境変数設定
  - NEXT_PUBLIC_SUPABASE_URL
  - NEXT_PUBLIC_SUPABASE_ANON_KEY
  - NEXTAUTH_URL（本番URL）
  - NEXTAUTH_SECRET
- [ ] デプロイ実行
- [ ] 本番環境で動作確認

---

## Phase 7: 本番準備（イベント前日）

### 16. データ準備
- [ ] データベースリセット（既存データクリア）
- [ ] 初期データ投入（必要に応じて）
- [ ] 問題の下書き作成（事前準備）

### 17. 最終確認
- [ ] URLをイベント参加者に共有
- [ ] ゲームマスター用URLを確認
- [ ] スマホでの表示確認
- [ ] ネットワーク環境確認
- [ ] バックアッププラン準備

---

## オプション機能（時間があれば）

### 18. 追加機能
- [ ] 画像アップロード機能（Supabase Storage使用）
- [ ] 投票済み確認API（GET /api/questions/:id/votes/me）
- [ ] 回答編集機能
- [ ] ゲーム状態管理API（current_question表示）
- [ ] タイマー自動遷移（制限時間超過で自動的に次フェーズへ）

---

## 実装時の注意事項

### 優先度
1. **最優先**: Phase 1-3（動くものを作る）
2. **重要**: Phase 4（リアルタイム更新）
3. **必要**: Phase 5-6（デプロイまで）
4. **オプション**: Phase 7以降

### 時間配分の目安
- Phase 1: 30分
- Phase 2: 2時間
- Phase 3: 4時間
- Phase 4: 1時間
- Phase 5: 1時間
- Phase 6: 1時間
- **合計: 約9-10時間**

### スキップ可能な箇所
- 画像アップロード機能（テキストのみでも動作）
- アニメーション
- 詳細なエラーハンドリング
- 高度なバリデーション

### 必須の箇所
- チーム作成・メンバー登録
- 問題作成・回答・投票
- リアルタイム更新（特に投票数）
- スコアボード

---

## トラブルシューティング

### よくある問題
1. **Realtime接続エラー**
   - Supabaseのプロジェクト設定でRealtimeが有効か確認
   - Row Level Security (RLS) を無効化（セキュリティ無視のため）

2. **CORSエラー**
   - Supabaseの設定でドメイン許可を確認
   - localhost と Vercel ドメインを追加

3. **デプロイ後に動かない**
   - 環境変数が正しく設定されているか確認
   - ビルドログを確認

---

## 完了条件

以下が全て動作すればMVP完成:
- ✅ ユーザーがログインしてチームに参加できる
- ✅ ゲームマスターが問題を作成できる
- ✅ チームが問題に回答できる
- ✅ メンバーが投票できる（自チーム除く）
- ✅ 結果が表示され、スコアが更新される
- ✅ リアルタイムで全員の画面が同期される
- ✅ スマホで快適に操作できる
